---
title: "United States and Science Values 2006 - 2011"
subtitle: "IS606 Final Project"
author: "Daniel Dittenhafer"
date: "December 7, 2015"
output: 
  pdf_document:
   fig_height: 3.25
   fig_width: 4.5
---
```{r include=FALSE, cache=FALSE}
# DO NOT REMOVE
# THIS IS FOR SETTING SOME PLOTTING PARAMETERS SO THAT YOUR PLOTS DON'T TAKE UP TOO MUCH SPACE
# IF YOU WOULD LIKE TO CHANGE THESE, SEE HELP FILES ON THE par() FUNCTION
# OR ASK FOR HELP
library(knitr)
## set global chunk options
opts_chunk$set(fig.path='figure/manual-', cache.path='cache/manual-', fig.show='hold', par=TRUE)
## tune details of base graphics (http://yihui.name/knitr/hooks)
knit_hooks$set(par=function(before, options, envir){
#if (before && options$fig.show!='none') par(mar=c(4,4,.2,.1),cex.lab=.95,cex.axis=.9,mgp=c(2,.7,0),tcl=-.3)
})
```

```{r, echo=FALSE}
library(plyr)
library(knitcitations)
library(RefManageR)
library(ggplot2)
library(grid)
library(gridExtra)
cleanbib()
cite_options(style="markdown")

bibWorldValSurvey <- bibentry(bibtype="Misc", 
                              author=person(family="World Values Survey Association"),
                              title="WORLD VALUES SURVEY 1981-2014 LONGITUDINAL AGGREGATE v.20150418",
                              year=2014,
                              url="http://www.worldvaluessurvey.org/WVSDocumentationWVL.jsp",
                              note="Aggregate File Producer: JDSystems",
                              address="Madrid SPAIN"
                              )

bibWvsFieldworkSampling <- bibentry(bibtype="Misc", 
                              author=person(family="World Values Survey Association"),
                              title="Fieldwork and Sampling",
                              year=2015,
                              url="http://www.worldvaluessurvey.org/WVSContents.jsp")

bibPewViewsOnScience <- bibentry(bibtype="Misc", 
                                 author=c(person(family="Funk", given="Cary"), person(family="Rainee", given="Lee")),
                                 title="Public and Scientists’ Views on Science and Society",
                                 year=2015,
                              url="http://www.pewinternet.org/2015/01/29/public-and-scientists-views-on-science-and-society/")

bibCensusPopEst06 <- bibentry(bibtype="Misc",
                            author=person(family="United States Census Bureau"),
                            title="Annual Population Estimates 2000 - 2006",
                            year=2006,
                            url="http://www.census.gov/popest/data/state/totals/2006/tables/NST-EST2006-01.csv")

bibCensusPopEst11 <- bibentry(bibtype="Misc",
                            author=person(family="United States Census Bureau"),
                            title="Annual Population Estimates",
                            year=2011,
                            url="http://www.census.gov/popest/data/state/totals/2011/tables/NST-EST2011-01.csv")

# My ggplot theme
myTheme <- theme(axis.ticks=element_blank(),
                 axis.title=element_text(size="10"),
                  panel.border = element_rect(color="gray", fill=NA), 
                  panel.background=element_rect(fill="#FBFBFB"), 
                  panel.grid.major.y=element_line(color="white", size=0.5), 
                  panel.grid.major.x=element_line(color="white", size=0.5),
                  plot.title=element_text(size="10"))
```

### Part 1 - Introduction:

How have the values of people from the United States changed over time with regard to science and technology and its positive/negative impact on the world? The World Values Survey includes a question where in the survey respondent is asked to characterize their view of science and the state of the world because of it `r citep(bibWorldValSurvey)`. Using the World Values Survey longitudinal data from 2006 and 2011, this project investigates changes in the views of United States respondents associated with science as well as correlations with educational level and/or the importance of religion.


### Part 2 - Data:

The World Values Survey is an observational study, and this data project will be analyzing a subset of the observational study conducted by the World Values Survey Association.
The data was collected and made available by the World Values Survey Association via their website. `r  citep(bibWorldValSurvey)`. 

The original data set in its entirety is available from the World Values Survey website: http://www.worldvaluessurvey.org/WVSDocumentationWVL.jsp

Although the World Values Survey was conducted in the United States starting in 1995, the question regarding science and the world (005_203) was not introducted until 2006. As such, only the cases from 2006 and beyond, 3481 cases across 2006 and 2011, are considered in this study.

#### Scope of Inferencce

Based on the data, collection methods and type of study, we review the scope of inference this data project can claim.

**Generalizability**: The population associated with the survey in this data project is the population of the United States between the ages of 18 and 85. *Is there bias, or is the data not representative of the age range?*

**Causality**: The data is derived from an observational survey and not an experiment. As such, no causality can be established from any conclusion.

#### Variables Included in Data Subset

The following table lists the variables extracted from the original World Values Survey dataset which will be considered in this data project.

 ID | Variable | Description
--|-----------|------------
005_203| E234 | The world is better off, or worse off, because of science and technology
010_023| S020 | Year survey
010_028| S024 | Country wave
010_004| S003 | Country/region
014_003| X003 | Age
014_030| X025 |	Highest educational level attained
001_006| A006	| Important in life: Religion

#### Response Variable

The response variable is the answer provided to the key question, "Is the world is better off, or worse off, because of science and technology?"

The answers are categorical in nature, but ordinal in their degree of support for the better/worse outcome. The distinct answer values and the description of each value are shown in the table below. Note that negative values are variations on missing data. These will be eliminated during the exploratory data phase.

Value | Description
------|------------
1|A lot worse off
2|2
3|3
4|4
5|5
6|6
7|7
8|8
9|9
10|A lot better off
-5|Missing; Unknown
-4|Not asked in survey
-3|Not applicable
-2|No answer
-1|Don´t know

#### Explanatory Variable(s)

The explanatory variables considered for analysis are the "Highest educational level attained" value and the "Important in life: Religion" variable. Again, these are categorical variables, but ordinal in terms of level of education and degree of importance of religion. The values and descriptions for each variable follow:

**Highest educational level attained**

Value | Description
------|------------
1|Inadequately completed elementary education
2|Completed (compulsory) elementary education
3|Incomplete secondary school: technical/vocational type/elementary education, basic vocational qual.
4|Complete secondary school: technical/vocational type/Secondary, intermediate vocational qualification
5|Incomplete secondary: university-preparatory type/Secondary, intermediate general qualification
6|Complete secondary: university-preparatory type/Full secondary, maturity level certificate
7|Some university without degree/Higher education - lower-level tertiary certificate
8|University with degree/Higher education - upper-level tertiary certificate
-5|Missing; Unknown
-4|Not asked in survey
-3|Not applicable; No formal education
-2|No answer
-1|Don´t know

**Important in life: Religion**

Value | Description
------|------------
-5|Missing; Unknown
-4|Not asked in survey
-3|Not applicable
-2|No answer
-1|Don´t know
1|Very important
2|Rather important
3|Not very important
4|Not at all important

### Part 3 - Exploratory data analysis:

```{r, echo=FALSE}
# 
# Original WVS Data File, Size 1.4GB
#
#dataFile <- "C:/Users/Dan/Downloads/WorldValuesSurvey/WVS_Longitudinal_1981-2014_rdata_v_2015_04_18/WVS_Longitudinal_1981_2014_R_v2015_04_18.rdata"
#load(dataFile)
#colsToKeep <- c("E234", "S020",  "S024", "S003", "X003", "X025", "A006")
#WVS_Subset <- WVS_Longitudinal_1981_2014_R_v2015_04_18[,colsToKeep]
#save(WVS_Subset, file="C:/Code/R/IS606-ProbStats/FinalProject/data/WVS_subData.RData")
```

```{r loading-data, echo=FALSE}
# load data
dataFile <- "C:/Code/R/IS606-ProbStats/FinalProject/data/WVS_subData.RData"
load(dataFile)
colnames(WVS_Subset) <- c("KeyQuestion",
                          "Year", 
                          "CountryWave", 
                          "Country", 
                          "Age", 
                          "HighestEducation",
                          "ReligionImportant")
# Subset to just United States
WVS_US <- WVS_Subset[WVS_Subset$Country == 840, ]
WVS_US$CountryName <- "United States"
```

Let us explore the variables within the data subset. First, some simple summary statistics:

```{r summary-raw, echo=FALSE}
summary(WVS_US)
```

The following table shows the mean and standard deviation of the response variable for the various years for which the survey was conducted. Unfortunately, in 1995 and 1999 the question regarding science was not asked as evidenced by the mean of -4 ("Not asked in survey") and standard deviation of 0 (no variation). As a result, the focus will be on differences between 2006 and 2011.

```{r data-year-subset, echo=FALSE}
dfYrMnSd <- plyr::ddply(WVS_US, .(Year), summarize, 
            meanResponse=mean(KeyQuestion), 
            sdResponse=sd(KeyQuestion))
colnames(dfYrMnSd) <- c("Year", "Mean", "Std Dev")
```

```{r, asis=TRUE, echo=FALSE}
kable(dfYrMnSd, format="markdown")
```

```{r, echo=FALSE}
# Subset to the years we are working with.
WVS_US_0611 <- WVS_US[WVS_US$Year > 1999,]
WVS_US_06 <- WVS_US_0611[WVS_US_0611$Year == 2006,]
WVS_US_11 <- WVS_US_0611[WVS_US_0611$Year == 2011,]
# What is response case distribution by year?
dfYearDist <- plyr::count(WVS_US_0611, "Year")
nrow0611 <- nrow(WVS_US_0611)
c06 <- dfYearDist[dfYearDist$Year == "2006", "freq"]
pc06 <- c06 / nrow0611 * 100

c11 <- dfYearDist[dfYearDist$Year == "2011", "freq"]
pc11 <- c11 / nrow0611 * 100

# How many are negative values in 2006?
df06AnswerDist <- plyr::count(WVS_US_06, "KeyQuestion")
cNeg06 <- sum(df06AnswerDist[df06AnswerDist$KeyQuestion < 0, "freq"])
nrow06 <- nrow(WVS_US_06)
pcNeg06 <- cNeg06 / nrow06 * 100
#df06AnswerDist

# How many are negative values in 2011?
df11AnswerDist <- plyr::count(WVS_US_11, "KeyQuestion")
cNeg11 <- sum(df11AnswerDist[df11AnswerDist$KeyQuestion < 0, "freq"])
nrow11 <- nrow(WVS_US_11)
pcNeg11 <- cNeg11 / nrow11 * 100
#df11AnswerDist

dfCases <- data.frame(Year=c(2006, 2011, "Total"), Cases=c(c06, c11, sum(c06, c11)), Ratio=c(pc06, pc11, sum(pc06, pc11)))
```

After eliminating the 1995 and 1999 data rows, `r nrow(WVS_US_0611)` cases remain. Of those, `r round(pc06, 2)`% are in 2006, and `r round(pc11, 2)`% are in 2011. The number of cases in the sample is less than 10% of the United States population in 2006  299,398,484 `r citep(bibCensusPopEst06)`. The same holds true for the 2011 population at 311,591,917 `r citep(bibCensusPopEst11)`.

```{r, asis=TRUE, echo=FALSE}
kable(dfCases, format="markdown")
```

```{r, data-distrib-year, echo=FALSE, message=FALSE}
g1 <- ggplot(data=WVS_US_0611) + 
  geom_bar(aes(x=Year), binwidth=1) +
  myTheme +
  labs(title="Response Distribution By Year")
g1
```

When viewing the data distribution of answer values for our `KeyQuestion` in each year, we see different distributions, as shown in the following Science Values Response Distribution histograms. Both years are skewed left, but 2006 appears a bit more normal where 2011 could be characterized as bi-modal at values 8 and 10. We see also that ~`r round(pcNeg06, 2)`% of 2006 answers and ~`r round(pcNeg11, 2)`%  of 2011 answers are negative and constitute missing values. These data rows will be removed shortly.

```{r, data-distrib-science, echo=FALSE, message=FALSE, fig.width=6}
g2 <- ggplot(data=WVS_US_0611) + 
  geom_histogram(aes(x=KeyQuestion), binwidth=1) +
  myTheme +
  facet_wrap(~ Year) +
  labs(title="Science Values Response Distribution")
g2
```

```{r, echo=FALSE}
# Subset to remove the missing/unknown values
WVS_US_0611_pos <- WVS_US_0611[WVS_US_0611$KeyQuestion > -1, ]
#WVS_US_06_pos <- WVS_US_0611_pos[WVS_US_0611_pos$Year == 2006, ]
#WVS_US_11_pos <- WVS_US_0611_pos[WVS_US_0611_pos$Year == 2011, ]
```

The missing/unknown response data rows have now been removed and we further explore the data. A [Quartile-Quartile plot](http://www.itl.nist.gov/div898/handbook/eda/section3/qqplot.htm) will be used to check the normalness of these distributions in more detail. As shown in the following charts, the distributions are not strictly normal, but for our purposes we will accept them as nearly normal. This allows us to proceed with the difference of two means analysis in Part 4 - Inference. 

```{r, echo=FALSE, fig.width=6, warning=FALSE}
# From http://stackoverflow.com/questions/19599745/qqline-in-ggplot2-with-facets?lq=1
#
# calculate the normal theoretical quantiles per group
df2 <- ddply(.data = WVS_US_0611_pos, .variables = .(Year), function(dat){
             q <- qqnorm(dat$KeyQuestion, plot = FALSE)
             dat$xq <- q$x
             dat
}
)

# plot the sample values against the theoretical quantiles
g6 <- ggplot(data = df2, aes(x = xq, y = KeyQuestion)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  xlab("Theoretical") +
  ylab("Sample") +
  facet_wrap(~ Year) + 
  ylim(0, 10) + 
  myTheme
g6
```

#### Age

In the following charts we see the age distribution of respondents to the science question. Both years are somewhat normally distributed but with a right skew. Older people are less represented in the data particularlly over the age of 75. Obviously we have more responses in 2011 (which matches the Response by Year result seen earlier).

```{r, data-distrib-age, echo=FALSE, message=FALSE, fig.width=6}
g4 <- ggplot(data=WVS_US_0611_pos) + 
  geom_histogram(aes(x=Age)) +
  facet_wrap(~ Year) +
  myTheme +
  labs(title="Age Distribution of Science Values Responses")
g4
```

#### Education Level

Now lets explore the education level of the science values respondents. Recall that the highest level in this survey is 8 - "University with degree/Higher education - upper-level tertiary certificate"", and -3 = "Not applicable; No formal education".

```{r, data-distrib-highestEd, echo=FALSE, message=FALSE, fig.width=6}
g4 <- ggplot(data=WVS_US_0611_pos) + 
  geom_histogram(aes(x=HighestEducation)) +
  facet_wrap(~ Year) +
  myTheme +
  labs(title="Education Level Distribution of Science Values Responses")
g4
```

The distributions shown in the previous charts raise some questions. Did the education level distribution change that much in 5 years? What bias's might be introduced with these education levels? Unfortunately, these questions are out of scope for this data project. 

### Part 4 - Inference:

Our initial interest relates to differences between years for the response variable. Is there a statistically significant difference between 2006 and 2011 for the response to the science and the world question? 

```{r data-year-subset_pos, echo=FALSE}
dfYrMnSd0611 <- plyr::ddply(WVS_US_0611_pos, .(Year), summarize, 
            meanResponse=mean(KeyQuestion), 
            sdResponse=sd(KeyQuestion),
            nResponse=length(KeyQuestion))
colnames(dfYrMnSd0611) <- c("Year", "Mean", "Std Dev", "n")
```

The following table lists the mean and standard deviation for our cleansed data set per our exploratory data analysis (Part 3).

```{r, asis=TRUE, echo=FALSE}
kable(dfYrMnSd0611, format="markdown")
```

```{r, echo=FALSE}
mn06 <- dfYrMnSd0611[dfYrMnSd0611$Year == 2006, "Mean"]
sd06 <- dfYrMnSd0611[dfYrMnSd0611$Year == 2006, "Std Dev"]
n06  <- dfYrMnSd0611[dfYrMnSd0611$Year == 2006, "n"] 

mn11 <- dfYrMnSd0611[dfYrMnSd0611$Year == 2011, "Mean"]
sd11 <- dfYrMnSd0611[dfYrMnSd0611$Year == 2011, "Std Dev"]
n11  <- dfYrMnSd0611[dfYrMnSd0611$Year == 2011, "n"] 

ptEst <- mn06 - mn11
se <- sqrt((sd06^2 / n06) + (sd11^2 / n11))
degFdm <- n06 - 1

```

Our hypothesis test is set up as follows:

\(H_0: \mu_{2006} - \mu_{2011} = 0\)

\(H_a: \mu_{2006} - \mu_{2011} \ne 0\)

\(\alpha = 0.05\)

The point estimate for the difference in means is `r ptEst`. 

\[\bar{x}_{2006} - \bar{x}_{2011} = `r ptEst`\]

The standard error of the point estimate becomes:

\[SE_{\bar{x}_{2011} - \bar{x}_{2006}} = \sqrt{\frac{\sigma^2_{2011}}{n_{2011}} + \frac{\sigma^2_{2006}}{n_{2006}}}=`r se`\]

The T-score is computed as:

```{r, echo=FALSE}
tScore <- (ptEst - 0) / se
pVal <- pt(tScore, df=degFdm)
```

\[T = \frac{`r ptEst` - 0}{`r se`} = `r tScore`\]

Using degrees of freedom  based on the smaller of \(n_{2006} - 1 = `r n06 - 1`\) vs \(n_{2011} - 1 = `r n11 - 1`\): df=`r degFdm` we get a p-value \(\approx `r round(pVal, 4)` < 0.05\). Therefore, we reject the null hypothesis and conclude that the United States' mean view of the world being better off because of science and technology has increased from 2006 to 2011.

We can construct a 95% confidence interval around the response variable's means and visualize it to get sense of the change and the range of probable population values.

```{r, echo=FALSE}
# Lookup t-value for our 95% CI
tStar06 <- qt(0.975, df=n06 - 1)
# Compute Standard Error of estimate
se06 <- sd06 / (sqrt(n06))
# Compute margin of error for CI
me06 <- tStar06 * se06
# Compute lower and upper bounds of CI.
lb06 <- mn06 - me06
ub06 <- mn06 + me06

tStar11 <- qt(0.975, df=n11 - 1)
se11 <- sd11 / (sqrt(n11))
me11 <- tStar11 * se11
lb11 <- mn11 - me11
ub11 <- mn11 + me11

dfYrMnSd0611 <- cbind(dfYrMnSd0611, data.frame(LowerBound=c(lb06, lb11), 
                                               UpperBound=c(ub06, ub11)))
```

```{r, echo=FALSE, asis=TRUE}
kable(dfYrMnSd0611, format="markdown")
```

```{r, echo=FALSE}
g7 <- ggplot(data=dfYrMnSd0611) + 
  geom_line(aes(x=Year, y=Mean), colour="lightblue") + 
  geom_errorbar(aes(x=Year, ymin=LowerBound, ymax=UpperBound), width=0.50) +
  ylim(5, 10) +
  labs(title="95% Confidence Interval for United States Science Values") +
  myTheme

g7
```

Now lets focus on what factors might be related to the belief that science is making the world better off. We'll start out looking at education level through a simple scatter plot. As can be seen in both the combined and per year plots, there doesn't appear to be any dominate relationship. 

```{r, echo=FALSE, fig.width=6}
g8 <- ggplot(data=WVS_US_0611_pos) + 
  geom_point(aes(x=HighestEducation, y=KeyQuestion), position="jitter", alpha=0.1) +
  facet_wrap(~ Year) +
  myTheme +
  labs(title="Education Level vs Science Values")
g8
```

```{r, echo=FALSE}
dfEdFactorStats <- plyr::ddply(WVS_US_0611_pos, .(HighestEducation, Year), summarize, 
            meanResponse=mean(KeyQuestion), 
            sdResponse=sd(KeyQuestion))
```

When viewing the the response variable mean by educational level, it appears there is a positive relationship. 

```{r, echo=FALSE, fig.width=6}
g9 <- ggplot(data=dfEdFactorStats) + 
  geom_line(aes(x=HighestEducation, y=meanResponse, colour=Year)) +
  facet_wrap(~ Year) +
  myTheme
g9
```

Our hypotheses for an analysis of variance (ANOVA) test are as follows:

\(H_0: \mu_1 = \mu_2 = \mu_3 = \mu_4 = \mu_5 = \mu_6 = \mu_7 = \mu_8, \text {The mean science values response is the same across all education levels.}\)

\(H_a: \text {At least one mean is different.}\)

```{r}
aov_ed_sci <- aov(KeyQuestion ~ HighestEducation, data=WVS_US_0611_pos)
summary(aov_ed_sci)
```

```{r}
dfEdFactorStats

m_sci_ed <- lm(HighestEducation ~ KeyQuestion, WVS_US_0611_pos)
summary(m_sci_ed)
```

### Part 5 - Conclusion: 


### References:

```{r, results='asis', echo=FALSE}
BibOptions(style="html", bib.style="authortitle")
bibliography()
```

### Appendix (optional):

Remove this section if you don't have an appendix

